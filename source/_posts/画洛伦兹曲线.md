---
title: 画洛伦兹曲线
date: 2020-05-10 09:39:08
tags: 小程序 react 算法 定积分 二分查找
---

## 背景

最近 B 站的宣传片《后浪》又引起了大家对社会贫富差距加大对关注，所以想开发一个小程序来通过基尼系数来大致绘画出洛伦兹曲线来估计自己所在的财富位置。

## 算法

图片示例：
![img](https://bkimg.cdn.bcebos.com/pic/8601a18b87d6277f1a928d9020381f30e824fc92?x-bce-process=image/crop,x_0,y_54,w_631,h_417/watermark,g_7,image_d2F0ZXIvYmFpa2U4MA==,xp_5,yp_5)

画洛伦兹曲线目前常被使用的方法主要有三种(引自百科)：

### 几何计算法

_即根据分组资料，按几何图形分块近似逼近计算的方法。_

### 间接拟合法

_即先拟合求出收入分配的概率密度函数，再根据概率密度函数导出洛伦兹曲线。_

### 曲线拟合法

_即选择适当的曲线直接拟合洛伦兹曲线，常用的曲线有二次曲线、指数曲线和幂函数曲线。_

_利用第一种方法不能得到洛伦兹曲线的表达式，只能用来计算基尼系数，但由于在计算分块面积时用直线近似地代替曲线，所估计的基尼系数要小于实际值，尤其在数据点较少时，误差较大。第二种方法由于计算收入分配的概率密度的复杂性，很难提出合适的概率函数。至于第三种方法，即直接用曲线方程去拟合洛伦兹曲线，应该不失为一种较好的方法，但目前主要的问题在于现有常用的曲线并不适用，曲线含义不明确，或拟合误差较大。_

由于有效数据只有一个基尼系数，所以我选择曲线拟合法，曲线就用二次曲线,指数曲线,幂函数曲线都做一次吧。

考虑到函数曲线必经过(0,0)与(1,1)坐标点最终得到洛伦兹曲线公式为

二次曲线公式

```js
y = a * Math.pow(x, 2) - (a - 1) * x;
```

指数曲线公式

```js
y = （Math.pow(a, x) - 1） / a;
```

幂函数

```js
y = Math.pow(x, a);
```

接下来要通过基尼系数 P 与定积分上面到公式建立联系来得到 a.

二次曲线定积分关联公式

```js
0.5 - p/2 = (a * Math.pow(x, 3)) / 3 + ((a - 1) * Math.pow(x, 2)) / 2;
//代入1简化得
a=3p
```

指数曲线定积分关联公式

```js
0.5 - p/2 = （Math.pow(a, x) - 1)/Math.log(a)/ a;
//代入1简化得
1/(0.5 + p/2) = Math.log(a)/ a;
```

到这步简化不下去了，不过如果用二分查找逼近也可以得到近似解。

幂函数曲线定积分关联公式

```js
0.5 - p / 2 = Math.pow(x, a + 1) / (a + 1);
//代入1简化得
a = 1 - 2p;
```

## 开发

接下来就开始开发画二次曲线与幂函数曲线来拟合洛伦兹曲线的小程序。
开发框架选用taro。
包含功能简介：

1. 输入基尼系数画出洛伦兹曲线,
1. 列出前1%，5%，10%，20%，50% 所占有的财富总量。
1. 输入人均资产与个人资产得到个人所在百分位置。
